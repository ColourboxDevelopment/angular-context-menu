angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(e,t,n,o,r,c,i){return function(l){function a(e,t){return g&&e&&f(e),d.then(function(n){return $||u(n,e),t&&$.css(t),m($),$})}function u(e,t){if(w=angular.element(l.container||document.body),$=angular.element(e),0===$.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter($,w),g=c.$new(),t&&f(t);var o=i(h,{$scope:g});v&&(g[v]=o),n($)(g)}function f(e){for(var t in e)g[t]=e[t]}function p(){var t=e.defer();return $?r.leave($,function(){g.$destroy(),$=null,t.resolve()}):t.resolve(),t.promise}function m(e){var t="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,n="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;t<e[0].offsetTop+e[0].offsetHeight&&e.css("top",e[0].offsetTop-e[0].offsetHeight+"px"),n<e[0].offsetLeft+e[0].offsetWidth&&e.css("left",e[0].offsetLeft-e[0].offsetWidth+"px")}function s(){return!!$}if(!(!l.template^!l.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var d,g,h=(l.template,l.controller||angular.noop),v=l.controllerAs,$=null,w=null;if(l.template){var x=e.defer();x.resolve(l.template),d=x.promise}else d=t.get(l.templateUrl,{cache:o}).then(function(e){return e.data});return{open:a,close:p,active:s}}}]).directive("hasContextMenu",["$injector","$document","$parse",function(e,t,n){return{restrict:"A",link:function(n,o,r){function c(e){f.open(p,l(e))}function i(){f.close()}function l(e){return e.pageX||e.pageY?(clickX=e.pageX,clickY=e.pageY):(clickX=e.clientX+document.documentElement.scrollLeft,clickY=e.clientY+document.documentElement.scrollTop),{left:Math.max(clickX,0)+"px",top:Math.max(clickY,0)+"px"}}function a(e){f.active()&&u&&2!==e.button&&n.$apply(function(){i()})}var u,f=e.get(r.target),p={},m=angular.element(t),s=r.triggerOnEvent||"contextmenu";if(r.locals){var d=r.locals.split(",");angular.forEach(d,function(e){e=e.trim(),p[e]=n[e]})}o.bind(s,function(e){u=e.target,e.preventDefault(),e.stopPropagation(),n.$apply(function(){c(e)})}),m.bind("keyup",function(e){f.active()&&27===e.keyCode&&n.$apply(function(){i()})}),m.bind("click",a),m.bind(s,a)}}}]);
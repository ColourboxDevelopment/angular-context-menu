angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(e,t,n,o,r,i,a){return function(c){function l(e,t){return h&&e&&u(e),d.then(function(n){return w||f(n,e),t&&w.css(t),s(w),w})}function f(e,t){if($=angular.element(c.container||document.body),w=angular.element(e),0===w.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter(w,$),h=i.$new(),t&&u(t);var o=a(g,{$scope:h});v&&(h[v]=o),n(w)(h)}function u(e){for(var t in e)h[t]=e[t]}function p(){var t=e.defer();return w?r.leave(w,function(){h.$destroy(),w=null,t.resolve()}):t.resolve(),t.promise}function s(e){var t="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,n="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth;t<e[0].offsetTop+e[0].offsetHeight&&e.css("top",e[0].offsetTop-e[0].offsetHeight+"px"),n<e[0].offsetLeft+e[0].offsetWidth&&e.css("left",e[0].offsetLeft-e[0].offsetWidth+"px")}function m(){return!!w}if(!(!c.template^!c.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var d,h,g=(c.template,c.controller||angular.noop),v=c.controllerAs,w=null,$=null;if(c.template){var x=e.defer();x.resolve(c.template),d=x.promise}else d=t.get(c.templateUrl,{cache:o}).then(function(e){return e.data});return{open:l,close:p,active:m}}}]).directive("hasContextMenu",["$injector","$window","$parse",function(e,t,n){return{restrict:"A",link:function(n,o,r){function i(e){u.open(p,c(e))}function a(){u.close()}function c(e){return{top:Math.max(e.pageY,0)+"px",left:Math.max(e.pageX,0)+"px"}}function l(e){u.active()&&f&&2!==e.button&&n.$apply(function(){a()})}var f,u=e.get(r.target),p={},s=angular.element(t),m=r.triggerOnEvent||"contextmenu";if(r.locals){var d=r.locals.split(",").map(function(e){return e.trim()});angular.forEach(d,function(e){p[e]=n[e]})}o.bind(m,function(e){f=e.target,e.preventDefault(),e.stopPropagation(),n.$apply(function(){i(e)})}),s.bind("keyup",function(e){u.active()&&27===e.keyCode&&n.$apply(function(){a()})}),s.bind("mousedown",l),s.bind(m,l)}}}]);